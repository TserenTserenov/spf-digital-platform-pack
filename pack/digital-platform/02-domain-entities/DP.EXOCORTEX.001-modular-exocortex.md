---
id: DP.EXOCORTEX.001
type: domain-entity
status: draft
created: 2026-02-10
trust:
  F: 3
  G: domain
  R: 0.5
epistemic_stage: emerging
---

# Модульный экзокортекс

## 1. Определение

**Модульный экзокортекс** — точка подключения пользователя к платформе: конфигурация его взаимодействия с ИИ-системами через модульный CLAUDE.md и структурированную Memory.

> Platform-space ≠ User-space (D.DTP.011). Экзокортекс состоит из общих модулей (platform-space) и персональных данных (user-space).

## 2. Проблемы, которые решает

| # | Проблема | Как решает |
|---|---------|------------|
| 1 | Перегрузка CLAUDE.md (~800 строк) → Claude пропускает правила | Модульность: CLAUDE.md ≤300 строк, остальное в ref и memory/*.md |
| 2 | Смешаны владельцы скилов (Claude Code vs Стратег) | Каждый модуль помечен владельцем (session / launchd / manual) |
| 3 | MEMORY.md — дамп всего (лимит 200 строк, обрезается) | Memory ≤100 строк: только оперативный контекст + ссылки |
| 4 | Нет разделения «всегда помни» vs «прочитай когда нужно» | 3-слойная архитектура инструкций |

## 3. Трёхслойная архитектура инструкций

По аналогии с архитектурой платформы (тонкий клиент → логика → домен):

```
┌─────────────────────────────────────────────────────┐
│  СЛОЙ 1: ОПЕРАТИВНАЯ ПАМЯТЬ (MEMORY.md)              │
│  ≤100 строк. ВСЕГДА в контексте.                     │
│  Блокирующие правила + РП недели + ссылки            │
└──────────────────────────┬──────────────────────────┘
                           ▼
┌─────────────────────────────────────────────────────┐
│  СЛОЙ 2: ПРАВИЛА РАБОТЫ                              │
│  CLAUDE.md (≤300 строк) — всегда загружается         │
│  CLAUDE-ref.md (≤400 строк) — по необходимости      │
└──────────────────────────┬──────────────────────────┘
                           ▼
┌─────────────────────────────────────────────────────┐
│  СЛОЙ 3: ДЕТАЛЬНЫЕ ЗНАНИЯ (memory/*.md)              │
│  Без лимита. По необходимости (по ссылкам).          │
│  strategist.md, bot-*.md, patterns.md, ...           │
└─────────────────────────────────────────────────────┘
```

### 3.1. Слой 1: MEMORY.md (оперативная память)

> Оперативная память ≠ Справочник (D.DTP.014). Memory = рабочий стол, не библиотека.

**Принцип:** Если Claude видит только MEMORY.md и ничего больше — он ДОЛЖЕН знать: (1) как открыть сессию, (2) что делать во время работы, (3) как закрыть.

**Структура:**

```markdown
# MEMORY.md — Оперативная память

## БЛОКИРУЮЩИЕ (проверяй ВСЕГДА)
1. WP Gate: Есть ли РП? → Нет = СТОП
2. Close: push ≠ закрытие → capture + подтверждение

## ВАЖНЫЕ (проверяй на рубежах)
3. Capture: На рубеже → «Capture: X → Y»
4. Отчёты: ВСЕ репо в ~/Github/

## РП текущей недели (W{N})
[таблица — обновляется weekly и on-close]

## Ссылки на детали
→ memory/strategist.md
→ memory/bot-*.md
→ memory/session-*.md
```

**Правила обновления:**

| Блок | Триггер обновления | Кто обновляет |
|------|-------------------|--------------|
| БЛОКИРУЮЩИЕ | Никогда (стабильные) | Разработчик платформы |
| ВАЖНЫЕ | Никогда (стабильные) | Разработчик платформы |
| РП недели | Weekly (strategy-session) + on-close | Стратег + Claude Code |
| Ссылки | При добавлении нового файла memory/*.md | Claude Code |

**Ключевое свойство:** Memory хранит ТОЛЬКО то, что **меняется по правилам**. То, что никогда не меняется (различения, FPF, правила типов) → Слой 2 (CLAUDE-ref.md) или Слой 3 (memory/*.md).

### 3.2. Слой 2: CLAUDE.md + CLAUDE-ref.md (правила работы)

**CLAUDE.md** (загружается автоматически, ≤300 строк):
- Архитектура репозиториев (классификация, ключевое правило)
- WP Gate (полный алгоритм)
- Протоколы сессии: Open (WP Gate + Ритуал), Work (Capture-to-Pack), Close

**CLAUDE-ref.md** (читается по необходимости, ≤400 строк):
- FPF (базовые различения, когда обращаться)
- Жёсткие различения (Hard Distinctions)
- Context Pack
- Правила работы по типам репозиториев (Pack, Downstream, Framework, Format)
- Чеклисты

**Когда Claude читает CLAUDE-ref.md:**
- При работе с Pack-репозиторием (нужны правила для Pack)
- При обнаружении терминологической путаницы (нужны различения)
- При создании документа (нужны чеклисты и frontmatter)

### 3.3. Слой 3: memory/*.md (детальные знания)

| Файл | Что содержит |
|------|-------------|
| `strategist.md` | Конфигурация Стратега, расписание, фазы, протоколы |
| `bot-state-machine.md` | FSM бота, стейты, переходы |
| `bot-refactoring-patterns.md` | Паттерны рефакторинга бота |
| `session-capture-rule.md` | Алгоритм capture-to-pack |
| `claude-md-maintenance.md` | Как обслуживать CLAUDE.md |
| `repo-classification.md` | Детали классификации репо |
| `wp-gate-lesson.md` | Урок о WP Gate |

## 4. Владельцы протоколов

| Протокол | Владелец | Где описан |
|----------|----------|-----------|
| Open (WP Gate + Ритуал) | **Claude Code** (сессия) | CLAUDE.md |
| Work (Capture-to-Pack) | **Claude Code** (сессия) | CLAUDE.md |
| Close | **Claude Code** (сессия) | CLAUDE.md |
| Day-Close | **Стратег** (launchd) | Pack (DP.AGENT.012) |
| Strategy-Cascade | **Стратег** (launchd) | Pack (DP.AGENT.012) |
| Обновление Memory | **Claude Code** (Close) + **Стратег** (weekly) | CLAUDE.md + Pack |

**Правило:** Протоколы Стратега (Day-Close, Strategy-Cascade) НЕ описываются в CLAUDE.md. Их место — паспорт Стратега в Pack или README.md strategist-agent.

> **Протокол ≠ Skill (Anthropic).** Наши «протоколы» — поведенческие инструкции для ИИ-системы (что делать при открытии/работе/закрытии сессии). Anthropic Skills — техническая фича Claude Code: кастомные slash-команды (/commit, /review). Мы можем реализовать свои протоколы через slash-commands Anthropic (downstream), но протокол — это знание о поведении, а slash-command — инструмент.

## 5. Модульность CLAUDE.md

CLAUDE.md состоит из **модулей**. Каждый модуль:

```markdown
## Модуль: [Название]
> Владелец: session | launchd | manual
> Статус: active | optional | disabled

[Содержимое модуля]
```

**Базовые модули (всегда включены):**
- Архитектура репозиториев (классификация, fallback chain)
- WP Gate (блокирующее правило)
- Протоколы сессии (Open/Work/Close)

**Опциональные модули (включаются пользователем):**
- Стратег-интеграция (команды /rp, /report)
- Capture-to-Pack (расширенный)
- Навигация знаний (кросс-репо ссылки)
- Специфика конкретного проекта

## 6. Шаблон Memory для нового пользователя

При подключении нового пользователя экзокортекс инстанциируется из шаблона:

```markdown
# MEMORY.md — [Имя пользователя]

## БЛОКИРУЮЩИЕ
1. WP Gate: [описание]
2. Close: [описание]

## РП текущей недели (W{N})
| # | РП | Бюджет | Статус | Дедлайн |
|---|-----|--------|--------|---------|
| — | (пусто — заполнится при первом стратегировании) | — | — | — |

## Ссылки на детали
→ (появятся по мере работы)
```

CLAUDE.md (модульный шаблон) + Стратег разворачивают Memory и поддерживают её актуальность.

## 7. IPO-паттерн экзокортекса

| Элемент | Описание |
|---------|----------|
| **Входы** | Репо пользователя, предпочтения, выбранные модули |
| **Обработка** | Инстанциация шаблонов (CLAUDE.md + Memory), подключение модулей |
| **Выходы** | Настроенные CLAUDE.md + CLAUDE-ref.md + MEMORY.md + memory/*.md |

## 8. Отчуждаемость экзокортекса

| Компонент | Platform-space | User-space |
|-----------|---------------|------------|
| CLAUDE.md | Модули, правила, протоколы | Выбор включённых модулей |
| CLAUDE-ref.md | Различения, FPF, чеклисты | — (полностью platform-space) |
| MEMORY.md | Структура, блоки, триггеры | Содержимое (РП, ссылки) |
| memory/*.md | Шаблоны файлов | Содержимое файлов |

**Принцип:** Шаблон одинаков для всех пользователей. Содержимое уникально.

## 9. Глоссарий компонентов экзокортекса

> Различение компонентов, чтобы не путать, что за что отвечает.

| Компонент | Что это | Кто создал | Когда загружается | Назначение |
|-----------|---------|-----------|-------------------|------------|
| **MEMORY.md** | Оперативная память | Claude Code (фича Anthropic) | Всегда (системный промпт) | Текущие РП, блокирующие правила, ссылки на детали |
| **Корневой CLAUDE.md** | Правила для ВСЕХ репо | Claude Code (фича Anthropic) | Всегда (для всех репо в ~/Github/) | Архитектура, WP Gate, протоколы сессии, FPF, различения |
| **Репо CLAUDE.md** | Правила для ОДНОГО репо | Claude Code (фича Anthropic) | В этом репо | Frontmatter, SPF, типо-специфика |
| **CLAUDE-ref.md** | Справочник (стабильные знания) | Экзокортекс (наш) | По необходимости | FPF, различения, чеклисты, правила по типам |
| **memory/*.md** | Детальные знания | Экзокортекс (наш) | По ссылкам | Стратег, бот, паттерны, уроки |
| **ИИ-системы** | Компоненты платформы (слой 3) | Мы проектируем | Как отдельные сервисы/скрипты | Стратег, Проводник, Экстрактор и др. |
| **Протоколы** | Поведенческие инструкции | Мы проектируем | Описаны в CLAUDE.md | Open, Work, Close, Day-Close, Strategy-Cascade |
| **Anthropic Skills** | Кастомные slash-команды | Anthropic (фича Claude Code) | По вызову (/command) | Можно использовать для запуска наших протоколов |

**Ключевые различения:**
- **Протокол ≠ Anthropic Skill**: Протокол = знание о поведении (в CLAUDE.md). Skill = техническая фича (slash-command). Протокол может быть реализован через Skill (downstream).
- **MEMORY.md ≠ CLAUDE.md**: Memory = что меняется (РП, статусы). CLAUDE.md = что стабильно (правила, протоколы).
- **ИИ-система ≠ Протокол**: ИИ-система = отдельный компонент (Стратег). Протокол = поведение внутри сессии Claude Code.
- **Корневой CLAUDE.md ≠ Репо CLAUDE.md**: Корневой = для всех репо. Репо = для одного.

## 10. Связанные документы

- [DP.ARCH.001 Архитектура](DP.ARCH.001-platform-architecture.md) — отчуждаемость как принцип
- [DP.AGENT.001 ИИ-системы](DP.AGENT.001-ai-agents.md) — Claude Code и Стратег как владельцы скилов
- [DP.NAV.001 Навигация знаний](DP.NAV.001-knowledge-navigation.md) — Memory содержит ссылки (уровень 4 навигации)
- [DP.AISYS.013 Знание-Экстрактор](DP.AISYS.013-knowledge-extractor.md) — capture-to-pack как примитив экстрактора
