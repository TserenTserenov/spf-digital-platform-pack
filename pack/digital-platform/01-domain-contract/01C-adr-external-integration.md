# ADR: Интеграция с внешними сервисами

## Статус

Accepted

## Контекст

Цифровой двойник должен получать данные из внешних сервисов пользователя (Linear, Google Calendar, Notion и др.) для формирования индикаторов.

Два варианта доступа:
1. **Shared API key** — один ключ от разработчика на всех пользователей
2. **Per-user OAuth** — каждый пользователь авторизует свой доступ

## Решение

**Per-user OAuth 2.0 Authorization Code Flow.**

Каждый пользователь самостоятельно авторизует доступ цифрового двойника к своим данным во внешних сервисах.

## Обоснование

| Критерий | Shared API key | Per-user OAuth |
|----------|---------------|----------------|
| Безопасность | Один ключ = одна точка отказа | Изоляция пользователей |
| Приватность | Разработчик видит всё | Только авторизованные данные |
| Масштабируемость | Rate limits на всех | Rate limits per-user |
| Управление | Разработчик отзывает доступ | Пользователь контролирует сам |

## Следствия

- Пользователь должен явно авторизовать каждый сервис
- Токены хранятся per-user
- При отзыве токена пользователем — данные перестают обновляться
- Downstream-реализация должна обрабатывать expired/revoked tokens
